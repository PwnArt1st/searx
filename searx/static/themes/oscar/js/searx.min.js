/*! oscar/searx.min.js | 29-04-2016 | https://github.com/asciimoo/searx */
requirejs.config({baseUrl:"./static/themes/oscar/js",paths:{app:"../app"}}),searx.autocompleter&&(searx.searchResults=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:"./autocompleter?q=%QUERY"}),searx.searchResults.initialize()),$(document).ready(function(){searx.autocompleter&&$("#q").typeahead(null,{name:"search-results",displayKey:function(a){return a},source:searx.searchResults.ttAdapter()})}),$(document).ready(function(){var a=function(a){var b=a.find(".result-table-header");if(1!==b.length)throw"table must contain one header row";if(this.headers=b.find("th"),this.headers.length<1)throw"table must contain at least one column";this.columns=[];for(var c=this,d=function(a){return function(b){var d=$(this),e="desc"===d.data("order");c.headers.find("span.sort-btn").removeClass("glyphicon-sort-by-attributes glyphicon-sort-by-attributes-alt").addClass("glyphicon-sort").data("order",null),d.removeClass("glyphicon-sort").addClass("glyphicon-sort-by-attributes"+(e?"-alt":"")).data("order",e?"asc":"desc"),c.sort(a,!e)}},e=function(a){return function(b){var d=c.el.searchRow,e=c.el.searchInput;if(c.headers.removeClass("tbl-highlight"),(d.hasClass("hidden")||e.data("colnum")===a)&&d.toggleClass("hidden"),e.val("").data("colnum",a),g(e),!d.hasClass("hidden")){var f=$(c.headers[a]);f.addClass("tbl-highlight"),e.attr("placeholder","search ("+f.text()+")"),e.focus()}}},f="",g=function(a){var b=a.data("colnum");if(!c._validColNum(b))throw"incorrect column number";for(var d=a.val().toLowerCase(),e=d.startsWith(f),g=0,h=0;h<c.rows.length;h++){var i=c.rows[h];e&&i.filtered||(i._icolumns instanceof Array||(i._icolumns=[]),"undefined"==typeof i._icolumns[b]&&(i._icolumns[b]=i.columns[b].toLowerCase()),i.filtered=i._icolumns[b].indexOf(d)<0,i.filtered?e&&c.trs[h].addClass("filtered"):i.hidden&&g++)}e?c._rebuildShowAllTr(g):c.build(),f=d},h=function(a){g($(a.target))},i="th-icon glyphicon ",j=0;j<this.headers.length;j++){var k=$(this.headers[j]),l=k.data("field");if(0===l.length)throw"empty field in "+(j+1)+" column";this.columns.push(l),k.hasClass("sortable")&&$('<span class="'+i+'sort-btn glyphicon-sort" />').on("click",d(j)).appendTo(k),$('<span class="'+i+'filter-btn glyphicon-search" />').on("click",e(j)).appendTo(k),k.css("white-space","nowrap")}var m="";m+='<tr class="result-search-row hidden">',m+='<td colspan="'+this.columns.length+'">',m+='<input type="text" placeholder="search" />',m+="</td>",m+="</tr>",this.el={searchRow:$(m)},a.append(this.el.searchRow),this.el.searchInput=this.el.searchRow.find("input").css("width","100%").on("input",h),this.table=a,this.rows=[],this.trs=[]};a.prototype._validColNum=function(a){return"number"==typeof a&&a>=0&&a<this.columns.length},a.prototype._rebuildShowAllTr=function(a){if(this.table.find(".show-all-tr").remove(),!(1>a)){var b="";b+='<tr class="clickable-tr show-all-tr">',b+='<td colspan="'+this.columns.length+'">',b+='<span class="btn-link text-info">',b+=1===a?"Display one other result":"Display "+a+" other results",b+="</span>",b+="</td>",b+="</tr>";var c=$(b),d=this;c.on("click",function(a){$(this).remove(),d.table.find("tr.data-row.hidden").removeClass("hidden");for(var b=0;b<d.rows.length;b++)d.rows[b].hidden=!1}),this.table.append(c)}},a.prototype.addRows=function(a,b){if(a instanceof Array)for(var c=0;c<a.length;c++)this.addRows(a[c],b);else{b=b===!0;var d=this.table.data("field-url");d||(d="url",console.warn("data-field-url not found in table, using default value"));var e=a[d];if(!e)throw"URL field not found";for(var f=[],g=0;g<this.columns.length;g++){var h=this.columns[g];if("undefined"==typeof a[h])throw h+" field not found";f.push(a[h].toString().trim())}this.rows.push({url:e,hidden:b,columns:f})}},a.prototype.build=function(){if(0===this.rows.length)throw"no rows were added";this.table.find("tr.data-row, tr.show-all-tr").remove(),this.trs=[];for(var a=0,b=0;b<this.rows.length;b++){var c=this.rows[b],d="clickable-tr data-row";c.hidden&&(d+=" hidden",c.filtered||a++),c.filtered&&(d+=" filtered");for(var e='<tr class="'+d+'" data-url="'+c.url+'">',f=0;f<c.columns.length;f++)e+="<td>"+c.columns[f]+"</td>";e+="</tr>";var g=$(e);this.table.append(g),this.trs.push(g)}a&&this._rebuildShowAllTr(a),this.table.find("tr.data-row[data-url]").on("click",function(){window.open($(this).data("url"),"_blank")});var h=this.table.data("sort-colnum");this._validColNum(h)&&this.table.find("tr.data-row").find("td:nth-child("+(h+1)+")").addClass("tbl-highlight")},a.prototype.sort=function(a,b){if(a>=this.headers.length)throw"invalid column number";this.rows.sort(function(c,d){var e=c.columns[a],f=d.columns[a];if(!e&&!f)return 0;if(!e)return 1;if(!f)return-1;var g=e.localeCompare(f,"en",{numeric:!0});return b?g:-g}),this.table.data("sort-colnum",a),this.build()},$(".video-download-link").on("click",function(b){function c(a){return'<p class="text-muted">'+a+"</p>"}$(this).off(b);var d=$(this),e=d.data("video-url"),f=d.data("hash"),g=d.data("index"),h=$(d.data("result-table")),i=$(d.data("result-panel")),j=$(d.data("load-icon"));$.getJSON("/video_links",{url:e,h:f},function(b){var d=new a(h);if(b.preferred.length>0)d.addRows(b.preferred,!1),b.filtered.length>0&&d.addRows(b.filtered,!0),d.build(),j.addClass("hidden"),i.removeClass("hidden");else if(b.filtered.length>0){d.addRows(b.filtered,!1),d.build();var e="No results in preferred formats were found, but there ";e+=1===b.filtered.length?"is one result in the other format.":"are "+b.filtered.length+" results in other formats.";var f="show-filtered-"+g,k='<a id="'+f+'" class="cursor-pointer">Display all available results</a>.';j.html(c(e)+c(k)),$("#"+f).on("click",function(a){j.addClass("hidden"),i.removeClass("hidden")})}else j.html(c("No media available for download."))}).fail(function(){j.html(c("Could not load data."))})})}),$(document).ready(function(){$("#q.autofocus").focus(),$(".select-all-on-click").click(function(){$(this).select()}),$(".btn-collapse").click(function(){var a=$(this).data("btn-text-collapsed"),b=$(this).data("btn-text-not-collapsed");""!==a&&""!==b&&($(this).hasClass("collapsed")?new_html=$(this).html().replace(a,b):new_html=$(this).html().replace(b,a),$(this).html(new_html))}),$(".btn-toggle .btn").click(function(){var a="btn-"+$(this).data("btn-class"),b=$(this).data("btn-label-default"),c=$(this).data("btn-label-toggled");""!==c&&($(this).hasClass("btn-default")?new_html=$(this).html().replace(b,c):new_html=$(this).html().replace(c,b),$(this).html(new_html)),$(this).toggleClass(a),$(this).toggleClass("btn-default")}),$(".media-loader").click(function(){var a=$(this).data("target"),b=$(a+" > iframe"),c=b.attr("src");void 0!==c&&c!==!1||b.attr("src",b.data("src"))}),$(".btn-sm").dblclick(function(){var a="btn-"+$(this).data("btn-class");$(this).hasClass("btn-default")?($(".btn-sm > input").attr("checked","checked"),$(".btn-sm > input").prop("checked",!0),$(".btn-sm").addClass(a),$(".btn-sm").addClass("active"),$(".btn-sm").removeClass("btn-default")):($(".btn-sm > input").attr("checked",""),$(".btn-sm > input").removeAttr("checked"),$(".btn-sm > input").checked=!1,$(".btn-sm").removeClass(a),$(".btn-sm").removeClass("active"),$(".btn-sm").addClass("btn-default"))})}),$(document).ready(function(){$(".searx_overpass_request").on("click",function(a){var b="https://overpass-api.de/api/interpreter?data=",c=b+"[out:json][timeout:25];(",d=");out meta;",e=$(this).data("osm-id"),f=$(this).data("osm-type"),g=$(this).data("result-table"),h="#"+$(this).data("result-table-loadicon"),i=["addr:city","addr:country","addr:housenumber","addr:postcode","addr:street"];if(e&&f&&g){g="#"+g;var j=null;switch(f){case"node":j=c+"node("+e+");"+d;break;case"way":j=c+"way("+e+");"+d;break;case"relation":j=c+"relation("+e+");"+d}if(j){$.ajax(j).done(function(a){if(a&&a.elements&&a.elements[0]){var b=a.elements[0],c=$(g).html();for(var d in b.tags)if(null===b.tags.name||-1==i.indexOf(d)){switch(c+="<tr><td>"+d+"</td><td>",d){case"phone":case"fax":c+='<a href="tel:'+b.tags[d].replace(/ /g,"")+'">'+b.tags[d]+"</a>";break;case"email":c+='<a href="mailto:'+b.tags[d]+'">'+b.tags[d]+"</a>";break;case"website":case"url":c+='<a href="'+b.tags[d]+'">'+b.tags[d]+"</a>";break;case"wikidata":c+='<a href="https://www.wikidata.org/wiki/'+b.tags[d]+'">'+b.tags[d]+"</a>";break;case"wikipedia":if(-1!=b.tags[d].indexOf(":")){c+='<a href="https://'+b.tags[d].substring(0,b.tags[d].indexOf(":"))+".wikipedia.org/wiki/"+b.tags[d].substring(b.tags[d].indexOf(":")+1)+'">'+b.tags[d]+"</a>";break}default:c+=b.tags[d]}c+="</td></tr>"}$(g).html(c),$(g).removeClass("hidden"),$(h).addClass("hidden")}}).fail(function(){$(h).html($(h).html()+'<p class="text-muted">could not load data!</p>')})}}$(this).off(a)}),$(".searx_init_map").on("click",function(a){var b=$(this).data("leaflet-target"),c=$(this).data("map-lon"),d=$(this).data("map-lat"),e=$(this).data("map-zoom"),f=$(this).data("map-boundingbox"),g=$(this).data("map-geojson");require(["leaflet-0.7.3.min"],function(a){f&&(southWest=L.latLng(f[0],f[2]),northEast=L.latLng(f[1],f[3]),map_bounds=L.latLngBounds(southWest,northEast)),L.Icon.Default.imagePath="./static/themes/oscar/img/map";var h=L.map(b),i="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",j='Map data © <a href="https://openstreetmap.org">OpenStreetMap</a> contributors',k=new L.TileLayer(i,{minZoom:1,maxZoom:19,attribution:j}),l="http://otile{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpg",m='Map data © <a href="https://openstreetmap.org">OpenStreetMap</a> contributors | Tiles Courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png">',n=new L.TileLayer(l,{minZoom:1,maxZoom:18,subdomains:"1234",attribution:m}),o="http://otile{s}.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.jpg",p='Map data © <a href="https://openstreetmap.org">OpenStreetMap</a> contributors | Tiles Courtesy of <a href="http://www.mapquest.com/" target="_blank">MapQuest</a> <img src="https://developer.mapquest.com/content/osm/mq_logo.png"> | Portions Courtesy NASA/JPL-Caltech and U.S. Depart. of Agriculture, Farm Service Agency';new L.TileLayer(o,{minZoom:1,maxZoom:11,subdomains:"1234",attribution:p});map_bounds?setTimeout(function(){h.fitBounds(map_bounds,{maxZoom:17})},0):c&&d&&(e?h.setView(new L.LatLng(d,c),e):h.setView(new L.LatLng(d,c),8)),h.addLayer(n);var q={"OSM Mapnik":k,MapQuest:n};L.control.layers(q).addTo(h),g&&L.geoJson(g).addTo(h)}),$(this).off(a)})});